// @format
const jQuery = require("jquery");

async function init() {
	chrome.runtime.sendMessage(
		{ contentEvent: "registerToReceiveCardDetails" },
		function (response) {
			console.log(
				"registerToReceiveCardDetails callback executed"
			);
		}
	);

	chrome.runtime.onMessage.addListener(function (
		request,
		sender,
		sendResponse
	) {
		if (request.contentEvent === "cardDetailsReceived") {
			console.log(
				"cardDetailsReceived passes event check and now executes callback"
			);
			let ccValue = request.cardDetails;
			console.log("request.cardDetails is set to: ");
			console.log(request.cardDetails);
			jQuery('form input[name="number"]').val(ccValues.num);
			jQuery('form input[name="name"]').val("Big dick tom");
			jQuery('form input[name="expiry"]').val(ccValues.exp_m);
			jQuery('form input[name="verification_value"]').val(
				ccValues.cv
			);
			sendResponse();
		}
	});
	const ccValues = {
		expiry: "07/25",
		number: "5556710069511443",
		verification_value: 631,
		name: "Steve Smith",
	};
	jQuery('form input[name="number"]').val(ccValues.number);
	jQuery('form input[name="name"]').val(ccValues.name);
	jQuery('form input[name="expiry"]').val(ccValues.expiry);
	jQuery('form input[name="verification_value"]').val(
		ccValues.verification_value
	);

	setInterval(() => {
		chrome.runtime.sendMessage(
			{ contentEvent: "checkIfCardDetailsShouldInject" },
			function (response) {
				console.log(response.result);

				const ccValues = {
					expiry: "07/25",
					number: "5556710069511443",
					verification_value: 631,
					name: "Steve Smith",
				};
				jQuery('form input[name="number"]').val(
					ccValues.number
				);
				jQuery('form input[name="name"]').val(
					ccValues.name
				);
				jQuery('form input[name="expiry"]').val(
					ccValues.expiry
				);
				jQuery(
					'form input[name="verification_value"]'
				).val(ccValues.verification_value);

				chrome.runtime.sendMessage(
					{ contentEvent: "cardDetailsInjected" },
					function (response) {
						console.log(response, result);
					}
				);
			}
		);
	}, 3000);
}

init();
